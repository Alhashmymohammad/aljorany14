<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<meta name="theme-color" content="#4f46e5">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Aljorany</title>
<link rel="manifest" href="manifest.json">
<style>
:root{--p1:#4f46e5;--p2:#7c3aed;--p3:#2563eb;--grad:linear-gradient(135deg,#4f46e5 0%,#7c3aed 50%,#2563eb 100%);--bg:#f5f3ff;--bg2:#ede9fe;--sf:#fff;--sf2:#f8f7ff;--tx:#1e1b4b;--tx2:#5b5b8a;--tx3:#9ca3af;--bd:rgba(99,102,241,.15);--bd2:rgba(99,102,241,.3);--sh:0 4px 20px rgba(79,70,229,.12);--ok:#10b981;--r:18px;--r2:12px;}
[data-theme=dark]{--bg:#0d0b1e;--bg2:#13103a;--sf:#1a1740;--sf2:#1e1b4b;--tx:#e8e5ff;--tx2:#a5b4fc;--tx3:#6b7280;--bd:rgba(99,102,241,.2);--bd2:rgba(99,102,241,.4);--sh:0 4px 20px rgba(0,0,0,.4);}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Tahoma,Arial,sans-serif;background:var(--bg);color:var(--tx);transition:background .3s,color .3s;display:flex;flex-direction:column;height:100vh;height:100dvh;}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;background:radial-gradient(ellipse 60% 50% at 20% 10%,rgba(99,102,241,.07) 0%,transparent 70%),radial-gradient(ellipse 50% 40% at 80% 80%,rgba(124,58,237,.06) 0%,transparent 70%);}
.hdr{background:var(--grad);padding:env(safe-area-inset-top,0) 0 0;flex-shrink:0;box-shadow:0 4px 30px rgba(79,70,229,.4);position:relative;z-index:10}
.hdr-in{display:flex;align-items:center;justify-content:space-between;padding:13px 16px}
.logo{display:flex;align-items:center;gap:10px}
.logo-ic{width:38px;height:38px;background:rgba(255,255,255,.2);border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:19px;border:1px solid rgba(255,255,255,.3)}
.logo-nm{font-size:21px;font-weight:900;color:#fff;letter-spacing:1px}
.logo-sb{font-size:10px;color:rgba(255,255,255,.75);font-weight:600}
.ib{width:38px;height:38px;border-radius:10px;border:1.5px solid rgba(255,255,255,.35);background:rgba(255,255,255,.15);color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.ib:active{transform:scale(.9)}
.scr{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;position:relative;z-index:1}
.scr::-webkit-scrollbar{width:0}
.cnt{padding:14px 13px 80px;max-width:600px;margin:0 auto;display:flex;flex-direction:column;gap:11px}
.card{background:var(--sf);border-radius:var(--r);border:1px solid var(--bd);box-shadow:var(--sh);overflow:hidden}
.chd{padding:13px 15px 9px;display:flex;align-items:center;gap:8px}
.cic{width:29px;height:29px;border-radius:8px;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0}
.ctt{font-size:12px;font-weight:700;color:var(--tx2);letter-spacing:.5px}
.cbd{padding:0 13px 13px}
#fi{display:none}
.iz{border:2px dashed var(--bd2);border-radius:var(--r2);padding:20px 14px;text-align:center;cursor:pointer;background:var(--sf2);transition:all .25s}
.iz:active{background:rgba(79,70,229,.08)}
.iz-ic{font-size:34px;margin-bottom:7px;display:block}
.iz-tx{font-size:14px;font-weight:700;color:var(--p1);margin-bottom:3px}
.iz-ht{font-size:10px;color:var(--tx3);line-height:1.5}
.finf{display:none;margin-top:9px;padding:11px;background:var(--sf2);border-radius:var(--r2);border:1px solid var(--bd);gap:9px;align-items:center}
.finf.on{display:flex}
.fi-ic{font-size:27px;flex-shrink:0}
.fi-dt{flex:1;min-width:0}
.fi-nm{font-size:12px;font-weight:700;color:var(--tx);word-break:break-all;line-height:1.3}
.fi-mt{font-size:10px;color:var(--tx3);margin-top:2px}
.sp{font-size:10px;font-weight:700;padding:3px 10px;border-radius:20px;white-space:nowrap;flex-shrink:0;background:var(--grad);color:#fff}
.pg{display:none;margin-top:11px}
.pg.on{display:block}
.pg-lb{display:flex;justify-content:space-between;font-size:11px;font-weight:700;color:var(--tx2);margin-bottom:5px}
.pg-tr{height:8px;background:var(--bg2);border-radius:8px;overflow:hidden}
.pg-br{height:100%;border-radius:8px;background:var(--grad);background-size:200% 100%;animation:gs 1.8s linear infinite;transition:width .4s cubic-bezier(.4,0,.2,1);width:0%}
@keyframes gs{0%{background-position:0% 50%}100%{background-position:200% 50%}}
.sts{display:none;grid-template-columns:repeat(3,1fr);gap:9px}
.sts.on{display:grid}
.sc{background:var(--sf);border-radius:var(--r2);border:1px solid var(--bd);padding:11px 7px;text-align:center;box-shadow:0 2px 8px rgba(79,70,229,.08)}
.sv{font-size:19px;font-weight:900;background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.sl{font-size:10px;color:var(--tx3);font-weight:600;margin-top:2px}
.sr{display:flex;gap:8px;align-items:stretch}
.si{flex:1;padding:13px 15px;border-radius:var(--r2);border:2px solid var(--bd);background:var(--sf2);color:var(--tx);font-size:15px;font-weight:600;outline:none;transition:all .25s;direction:rtl;min-width:0;font-family:inherit}
.si:focus{border-color:var(--p1);background:var(--sf);box-shadow:0 0 0 4px rgba(79,70,229,.12)}
.si::placeholder{color:var(--tx3);font-weight:400}
.sb{width:50px;border-radius:var(--r2);border:none;background:var(--grad);color:#fff;font-size:19px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;box-shadow:var(--sh)}
.sb:active{transform:scale(.93)}
.sb:disabled{opacity:.4;cursor:not-allowed;transform:none}
.mr{display:flex;align-items:center;justify-content:center;gap:5px;margin-top:9px;font-size:11px;color:var(--tx3)}
.mp{padding:3px 10px;border-radius:20px;background:rgba(79,70,229,.12);color:var(--p1);font-size:11px;font-weight:700}
.ft{width:100%;margin-top:9px;padding:9px 13px;border-radius:10px;border:1.5px solid var(--bd);background:transparent;color:var(--p1);font-size:12px;font-weight:700;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:all .2s}
.ft:active{background:var(--sf2)}
.fp{display:none;flex-direction:column;gap:13px;margin-top:11px;padding-top:11px;border-top:1px solid var(--bd)}
.fp.on{display:flex}
.fst{font-size:10px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:7px}
.chs{display:flex;flex-wrap:wrap;gap:6px}
.ch{padding:6px 13px;border-radius:20px;border:1.5px solid var(--bd2);background:var(--sf2);color:var(--tx2);font-size:11px;font-weight:700;font-family:inherit;cursor:pointer;transition:all .2s;white-space:nowrap}
.ch.on{background:var(--grad);color:#fff;border-color:transparent;box-shadow:0 3px 12px rgba(79,70,229,.3)}
.ch:active{transform:scale(.95)}
.md{padding:8px 11px;border-radius:9px;background:var(--sf2);border:1px solid var(--bd);font-size:11px;color:var(--tx2);line-height:1.7;margin-top:7px}
.rh{padding:13px 15px 9px;display:flex;align-items:center;justify-content:space-between}
.rt{font-size:13px;font-weight:800;display:flex;align-items:center;gap:7px}
.cp{background:var(--grad);color:#fff;font-size:11px;font-weight:700;padding:3px 11px;border-radius:20px}
.ca{padding:6px 13px;border-radius:8px;border:none;background:linear-gradient(135deg,#10b981,#06b6d4);color:#fff;font-size:11px;font-weight:700;font-family:inherit;cursor:pointer;transition:all .2s}
.ca:active{transform:scale(.95)}
.rl{padding:0 11px 11px;display:flex;flex-direction:column;gap:9px}
.ri{background:var(--sf2);border:1.5px solid var(--bd);border-right:4px solid var(--p1);border-radius:13px;padding:12px 12px 12px 44px;position:relative;animation:fu .22s ease both}
@keyframes fu{from{opacity:0;transform:translateY(-7px)}to{opacity:1;transform:translateY(0)}}
.rn{font-size:16px;font-weight:800;color:var(--tx);line-height:1.5;margin-bottom:7px}
.rn mark{background:linear-gradient(135deg,rgba(79,70,229,.2),rgba(124,58,237,.2));color:var(--p1);border-radius:4px;padding:0 3px;font-weight:900;font-style:normal}
.rtg{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:9px}
.tg{font-size:10px;padding:2px 8px;border-radius:20px;background:rgba(79,70,229,.1);color:var(--p2);font-weight:700}
.rc{display:flex;flex-wrap:wrap;gap:4px;padding-top:8px;border-top:1px dashed var(--bd2)}
.ce{padding:3px 9px;border-radius:7px;font-size:11px;font-weight:600;border:1px solid var(--bd);background:var(--sf);color:var(--tx);word-break:break-word;line-height:1.5}
.ce.ht{background:linear-gradient(135deg,rgba(79,70,229,.15),rgba(124,58,237,.15));border-color:var(--p1);color:var(--p1);font-weight:700}
.cb{position:absolute;top:11px;left:11px;width:29px;height:29px;border-radius:7px;border:none;background:rgba(79,70,229,.1);color:var(--p1);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}
.cb:active{transform:scale(.9)}
.cb.ok{background:var(--ok);color:#fff}
.em{text-align:center;padding:45px 18px}
.ei{font-size:50px;margin-bottom:12px}
.et{font-size:13px;line-height:1.8;color:var(--tx2)}
.toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(100px);background:#1e1b4b;color:#fff;padding:10px 22px;border-radius:30px;font-size:12px;font-weight:700;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,.4);transition:transform .35s cubic-bezier(.34,1.56,.64,1);white-space:nowrap;pointer-events:none}
.toast.on{transform:translateX(-50%) translateY(0)}
</style>
</head>
<body data-theme="light">
<div class="hdr">
  <div class="hdr-in">
    <div class="logo">
      <div class="logo-ic">ğŸ”</div>
      <div><div class="logo-nm">Aljorany</div><div class="logo-sb">Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Excel</div></div>
    </div>
    <button class="ib" onclick="tTheme()" id="tBtn">ğŸŒ™</button>
  </div>
</div>
<div class="scr"><div class="cnt">
  <div class="card">
    <div class="chd"><div class="cic">ğŸ“‚</div><div class="ctt">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Excel</div></div>
    <div class="cbd">
      <input type="file" id="fi" accept=".xlsx,.xls,.xlsm,.xlsb,.xltx,.xltm,.ods,.csv" onchange="loadF(this)">
      <div class="iz" onclick="document.getElementById('fi').click()">
        <span class="iz-ic">ğŸ“Š</span>
        <div class="iz-tx">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù</div>
        <div class="iz-ht">xlsx Â· xls Â· xlsm Â· xlsb Â· xltx Â· xltm Â· ods Â· csv</div>
      </div>
      <div class="finf" id="finf">
        <div class="fi-ic">ğŸ“—</div>
        <div class="fi-dt"><div class="fi-nm" id="fNm"></div><div class="fi-mt" id="fMt"></div></div>
        <div class="sp" id="fSt">Ø¬Ø§Ø±ÙŠ</div>
      </div>
      <div class="pg" id="pg">
        <div class="pg-lb"><span id="pLb">Ø¬Ø§Ø±ÙŠ...</span><span id="pPc">0%</span></div>
        <div class="pg-tr"><div class="pg-br" id="pBr"></div></div>
      </div>
    </div>
  </div>
  <div class="sts" id="sts">
    <div class="sc"><div class="sv" id="sR">0</div><div class="sl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙÙˆÙ</div></div>
    <div class="sc"><div class="sv" id="sS">0</div><div class="sl">Ø§Ù„Ø£ÙˆØ±Ø§Ù‚</div></div>
    <div class="sc"><div class="sv" id="sN">â€”</div><div class="sl">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</div></div>
  </div>
  <div class="card">
    <div class="chd"><div class="cic">ğŸ”</div><div class="ctt">Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</div></div>
    <div class="cbd">
      <div class="sr">
        <input class="si" id="sI" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù„Ø«..." oninput="onI()" onkeydown="if(event.key==='Enter')doS()">
        <button class="sb" id="sB" onclick="doS()" disabled>ğŸ”</button>
      </div>
      <div class="mr">ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø­Ø«: <span class="mp" id="mP">ğŸ¯ ØªØ±ØªÙŠØ¨ Ø¯Ù‚ÙŠÙ‚</span></div>
      <div class="fp" id="fpn">
        <div>
          <div class="fst">âš™ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø­Ø«</div>
          <div class="chs">
            <button class="ch on" id="mE" onclick="sMode('exact')">ğŸ¯ ØªØ±ØªÙŠØ¨ Ø¯Ù‚ÙŠÙ‚</button>
            <button class="ch" id="mA" onclick="sMode('any')">ğŸ”„ Ø£ÙŠ ØªØ±ØªÙŠØ¨</button>
            <button class="ch" id="mS" onclick="sMode('start')">â–¶ï¸ ÙŠØ¨Ø¯Ø£ Ø¨Ù€</button>
          </div>
          <div class="md" id="mD">ğŸ¯ <b>ØªØ±ØªÙŠØ¨ Ø¯Ù‚ÙŠÙ‚:</b> ÙŠØ¨Ø­Ø« Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø¶Ø¨Ø· â€” ÙÙŠ Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø®Ù„Ø§ÙŠØ§ Ù…ØªØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„ØµÙ</div>
        </div>
        <div>
          <div class="fst">ğŸ“„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ±Ù‚Ø©</div>
          <div class="chs" id="shC"><button class="ch on" onclick="sSheet('__all__',this)">ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚</button></div>
        </div>
      </div>
      <button class="ft" onclick="tF()"><span id="fA">â–¼</span><span id="fT">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø©</span></button>
    </div>
  </div>
  <div class="card" id="rC" style="display:none">
    <div class="rh">
      <div class="rt">Ø§Ù„Ù†ØªØ§Ø¦Ø¬ <span class="cp" id="cP">0</span></div>
      <button class="ca" onclick="cpAll()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙ„</button>
    </div>
    <div class="rl" id="rL"></div>
  </div>
  <div class="card" id="eC">
    <div class="em"><div class="ei">ğŸ“Š</div><div class="et">Ø§Ø³ØªÙˆØ±Ø¯ Ù…Ù„Ù Excel<br>Ø«Ù… Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</div></div>
  </div>
</div></div>
<div class="toast" id="tst"></div>

<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ù…ÙƒØªØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© xlsx/xls/csv Ù…Ø¯Ù…Ø¬Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
   ØªØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª 100%
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const XR = {
  /* â”€â”€ CSV â”€â”€ */
  csv(txt) {
    const rows = [];
    const lines = txt.split(/\r?\n/);
    for (const ln of lines) {
      if (!ln.trim()) continue;
      const cells = []; let cur = '', q = false;
      for (let i = 0; i < ln.length; i++) {
        const c = ln[i];
        if (c === '"') { q = !q; continue; }
        if (c === ',' && !q) { cells.push(cur.trim()); cur = ''; }
        else cur += c;
      }
      cells.push(cur.trim());
      if (cells.some(x => x)) rows.push(cells);
    }
    return [{ name: 'Sheet1', rows }];
  },

  /* â”€â”€ XLSX / XLSM / XLTX (ZIP+XML) â”€â”€ */
  async xlsx(buf) {
    const u8 = new Uint8Array(buf);
    const files = await this._unzip(u8);
    if (!files) return null;

    const ss = this._ss(files['xl/sharedStrings.xml'] || '');
    const wb = this._wb(files['xl/workbook.xml'] || '');
    const rl = this._rl(files['xl/_rels/workbook.xml.rels'] || '');
    const sheets = [];

    for (const sh of wb) {
      const tgt = rl[sh.id];
      if (!tgt) continue;
      const key = 'xl/' + tgt.replace(/^\.\.\//, '');
      const xml = files[key] || files['xl/worksheets/' + tgt.split('/').pop()] || '';
      if (!xml) continue;
      sheets.push({ name: sh.name, rows: this._ws(xml, ss) });
    }
    return sheets.length ? sheets : null;
  },

  /* â”€â”€ ÙÙƒ ZIP â”€â”€ */
  async _unzip(u8) {
    const out = {};
    let i = 0;
    while (i < u8.length - 30) {
      if (u8[i] !== 0x50 || u8[i+1] !== 0x4B || u8[i+2] !== 0x03 || u8[i+3] !== 0x04) { i++; continue; }
      const cm   = u8[i+8]  | u8[i+9]<<8;
      const csz  = u8[i+18] | u8[i+19]<<8 | u8[i+20]<<16 | (u8[i+21] & 0x7f)<<24;
      const usz  = u8[i+22] | u8[i+23]<<8 | u8[i+24]<<16 | (u8[i+25] & 0x7f)<<24;
      const nlen = u8[i+26] | u8[i+27]<<8;
      const xlen = u8[i+28] | u8[i+29]<<8;
      const name = new TextDecoder().decode(u8.subarray(i+30, i+30+nlen));
      const ds   = i + 30 + nlen + xlen;
      const dat  = u8.subarray(ds, ds + csz);
      if (name.endsWith('.xml') || name.endsWith('.rels')) {
        try {
          if (cm === 0) out[name] = new TextDecoder('utf-8', {fatal:false}).decode(dat);
          else if (cm === 8) out[name] = await this._inf(dat);
        } catch(_) {}
      }
      i = ds + csz;
    }
    return Object.keys(out).length ? out : null;
  },

  /* â”€â”€ inflate async via DecompressionStream â”€â”€ */
  async _inf(dat) {
    try {
      const ds = new DecompressionStream('deflate-raw');
      const writer = ds.writable.getWriter();
      const reader = ds.readable.getReader();
      writer.write(dat);
      writer.close();
      const chunks = [];
      while (true) {
        const { value, done } = await reader.read();
        if (done) break;
        chunks.push(value);
      }
      let total = chunks.reduce((s, c) => s + c.length, 0);
      const result = new Uint8Array(total);
      let offset = 0;
      for (const chunk of chunks) { result.set(chunk, offset); offset += chunk.length; }
      return new TextDecoder('utf-8', {fatal:false}).decode(result);
    } catch(e) {
      // fallback: raw decode
      return new TextDecoder('utf-8', {fatal:false}).decode(dat);
    }
  },

  /* â”€â”€ Shared Strings â”€â”€ */
  _ss(xml) {
    const arr = [];
    const re = /<si>([\s\S]*?)<\/si>/g;
    let m;
    while ((m = re.exec(xml)) !== null) {
      const si = m[1];
      let val = '';
      const tr = /<t[^>]*>([^<]*)<\/t>/g;
      let tm;
      while ((tm = tr.exec(si)) !== null) val += tm[1];
      arr.push(this._xe(val));
    }
    return arr;
  },

  /* â”€â”€ Workbook â”€â”€ */
  _wb(xml) {
    const sheets = [];
    const re = /<sheet[^>]+name="([^"]*)"[^>]+r:id="([^"]*)"/g;
    let m;
    while ((m = re.exec(xml)) !== null) sheets.push({ name: this._xe(m[1]), id: m[2] });
    return sheets;
  },

  /* â”€â”€ Relationships â”€â”€ */
  _rl(xml) {
    const map = {};
    const re = /<Relationship[^>]+Id="([^"]*)"[^>]+Target="([^"]*)"/g;
    let m;
    while ((m = re.exec(xml)) !== null) map[m[1]] = m[2];
    return map;
  },

  /* â”€â”€ Worksheet â”€â”€ */
  _ws(xml, ss) {
    const rows = [];
    /* Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„ØµÙÙˆÙ */
    const rowRe = /<row[^>]*>([\s\S]*?)<\/row>/g;
    let rm;
    while ((rm = rowRe.exec(xml)) !== null) {
      const rowXml = rm[1];
      const cells = {};
      const cRe = /<c\s([^>]*)>([\s\S]*?)<\/c>/g;
      let cm;
      while ((cm = cRe.exec(rowXml)) !== null) {
        const attrs = cm[1];
        const inner = cm[2];
        /* Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø®Ù„ÙŠØ© */
        const refM = attrs.match(/r="([A-Z]+)(\d+)"/);
        if (!refM) continue;
        const col = this._col(refM[1]);
        /* Ù†ÙˆØ¹ Ø§Ù„Ù‚ÙŠÙ…Ø© */
        const tM = attrs.match(/t="([^"]*)"/);
        const vM = inner.match(/<v>([^<]*)<\/v>/);
        const isM = inner.match(/<is>([\s\S]*?)<\/is>/);
        let val = '';
        if (isM) {
          const tRe2 = /<t[^>]*>([^<]*)<\/t>/g; let tm2;
          while ((tm2 = tRe2.exec(isM[1])) !== null) val += tm2[1];
          val = this._xe(val);
        } else if (vM) {
          const raw = vM[1];
          if (tM && tM[1] === 's') {
            val = ss[parseInt(raw)] || '';
          } else {
            val = raw;
          }
        }
        if (val !== '') cells[col] = val;
      }
      if (Object.keys(cells).length) {
        const maxC = Math.max(...Object.keys(cells));
        const arr = [];
        for (let i = 0; i <= maxC; i++) arr.push(cells[i] || '');
        rows.push(arr);
      }
    }
    return rows;
  },

  /* â”€â”€ ØªØ­ÙˆÙŠÙ„ Ø¹Ù…ÙˆØ¯ (Aâ†’0, Bâ†’1, AAâ†’26) â”€â”€ */
  _col(s) {
    let n = 0;
    for (let i = 0; i < s.length; i++) n = n * 26 + s.charCodeAt(i) - 64;
    return n - 1;
  },

  /* â”€â”€ XML entities â”€â”€ */
  _xe(s) {
    return s.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&quot;/g,'"').replace(/&#(\d+);/g,(_,n)=>String.fromCharCode(n)).replace(/&#x([0-9a-fA-F]+);/g,(_,h)=>String.fromCharCode(parseInt(h,16)));
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø§Ù„Ø­Ø§Ù„Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let SH=[], TOT=0, DK=false, MODE='exact', ACT='__all__';

function tTheme(){DK=!DK;document.body.setAttribute('data-theme',DK?'dark':'light');document.getElementById('tBtn').textContent=DK?'â˜€ï¸':'ğŸŒ™';}

let _t;
function toast(m,ms=2500){clearTimeout(_t);const e=document.getElementById('tst');e.textContent=m;e.classList.add('on');_t=setTimeout(()=>e.classList.remove('on'),ms);}
function sz(b){return b<1048576?(b/1024).toFixed(1)+' KB':(b/1048576).toFixed(1)+' MB';}
function sp(p,l){document.getElementById('pBr').style.width=Math.min(p,100)+'%';document.getElementById('pPc').textContent=Math.round(p)+'%';if(l)document.getElementById('pLb').textContent=l;}
const slp=ms=>new Promise(r=>setTimeout(r,ms));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadF(inp) {
  const file = inp.files[0]; if (!file) return;
  SH=[]; TOT=0; ACT='__all__';
  document.getElementById('rC').style.display='none';
  document.getElementById('eC').style.display='block';
  document.getElementById('sts').classList.remove('on');
  document.getElementById('sB').disabled=true;
  document.getElementById('sN').textContent='â€”';
  document.getElementById('finf').classList.add('on');
  document.getElementById('fNm').textContent=file.name;
  document.getElementById('fMt').textContent=sz(file.size)+' â€¢ '+new Date(file.lastModified).toLocaleDateString('ar');
  document.getElementById('fSt').textContent='ÙŠÙØ­Ù…ÙÙ‘Ù„';
  document.getElementById('pg').classList.add('on');
  sp(5,'Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...');

  const buf = await file.arrayBuffer();
  sp(30,'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...'); await slp(20);

  try {
    let sheets = null;
    const name = file.name.toLowerCase();

    if (name.endsWith('.csv')) {
      const txt = new TextDecoder('utf-8',{fatal:false}).decode(buf);
      sheets = XR.csv(txt);
    } else if (name.endsWith('.xlsx')||name.endsWith('.xlsm')||name.endsWith('.xltx')||name.endsWith('.xltm')) {
      sheets = await XR.xlsx(buf);
      if (!sheets) throw new Error('ØªØ¹Ø°Ù‘Ø± ÙÙƒ Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù â€” Ø¬Ø±Ù‘Ø¨ Ø­ÙØ¸Ù‡ ÙƒÙ€ CSV Ù…Ù† Excel');
    } else if (name.endsWith('.xls')||name.endsWith('.xlsb')) {
      throw new Error('ØµÙŠØºØ© XLS/XLSB ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© â€” ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙÙŠ Excel ÙˆØ­ÙØ¸Ù‡ ÙƒÙ€ XLSX Ø£Ùˆ CSV');
    } else {
      sheets = await XR.xlsx(buf);
      if (!sheets) throw new Error('ØªØ¹Ø°Ù‘Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
    }

    sp(70,'Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...'); await slp(20);

    for (let i=0; i<sheets.length; i++) {
      const rows = sheets[i].rows.filter(r=>r.some(c=>c&&c.trim()!==''));
      SH.push({ name: sheets[i].name, rows });
      TOT += rows.length;
      sp(70+((i+1)/sheets.length)*28, 'ÙˆØ±Ù‚Ø©: '+sheets[i].name);
      await slp(10);
    }

    sp(100,'Ø§ÙƒØªÙ…Ù„ âœ…');
    document.getElementById('fSt').textContent='âœ… Ø¬Ø§Ù‡Ø²';
    document.getElementById('sR').textContent=TOT.toLocaleString('ar');
    document.getElementById('sS').textContent=SH.length.toLocaleString('ar');
    document.getElementById('sts').classList.add('on');
    document.getElementById('sB').disabled=false;
    bChips(SH.map(s=>s.name));
    toast('âœ… '+file.name+' â€” '+TOT.toLocaleString('ar')+' ØµÙ');
    setTimeout(()=>document.getElementById('pg').classList.remove('on'),900);

  } catch(err) {
    console.error(err);
    document.getElementById('fSt').textContent='âŒ Ø®Ø·Ø£';
    toast('âŒ '+err.message);
    document.getElementById('pg').classList.remove('on');
  }
}

function bChips(names){
  const w=document.getElementById('shC');
  w.innerHTML='<button class="ch on" onclick="sSheet(\'__all__\',this)">ÙƒÙ„ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚</button>';
  names.forEach(n=>{const b=document.createElement('button');b.className='ch';b.textContent=n;b.onclick=()=>sSheet(n,b);w.appendChild(b);});
}
function sSheet(n,btn){ACT=n;document.querySelectorAll('#shC .ch').forEach(b=>b.classList.remove('on'));btn.classList.add('on');}

let fo=false;
function tF(){fo=!fo;document.getElementById('fpn').classList.toggle('on',fo);document.getElementById('fA').textContent=fo?'â–²':'â–¼';document.getElementById('fT').textContent=fo?'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª':'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙÙ„ØªØ±Ø©';}

const MI={
  exact:{p:'ğŸ¯ ØªØ±ØªÙŠØ¨ Ø¯Ù‚ÙŠÙ‚',d:'ğŸ¯ <b>ØªØ±ØªÙŠØ¨ Ø¯Ù‚ÙŠÙ‚:</b> ÙŠØ¨Ø­Ø« Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ø¨Ø§Ù„Ø¶Ø¨Ø· â€” ÙÙŠ Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø®Ù„Ø§ÙŠØ§ Ù…ØªØªØ§Ù„ÙŠØ©'},
  any:{p:'ğŸ”„ Ø£ÙŠ ØªØ±ØªÙŠØ¨',d:'ğŸ”„ <b>Ø£ÙŠ ØªØ±ØªÙŠØ¨:</b> ÙŠØ¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙˆØ£ÙŠ ØªØ±ØªÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ'},
  start:{p:'â–¶ï¸ ÙŠØ¨Ø¯Ø£ Ø¨Ù€',d:'â–¶ï¸ <b>ÙŠØ¨Ø¯Ø£ Ø¨Ù€:</b> ÙŠØ¬Ù„Ø¨ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆØªØ­ØªÙˆÙŠ Ø§Ù„Ø¨Ø§Ù‚ÙŠ'}
};
function sMode(m){
  MODE=m;
  ['exact','any','start'].forEach(x=>{
    const id=x==='exact'?'mE':x==='any'?'mA':'mS';
    document.getElementById(id).classList.toggle('on',x===m);
  });
  document.getElementById('mP').textContent=MI[m].p;
  document.getElementById('mD').innerHTML=MI[m].d;
}

function onI(){document.getElementById('sB').disabled=SH.length===0||!document.getElementById('sI').value.trim();}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function nm(t){
  return String(t)
    .replace(/[Ø£Ø¥Ø¢Ø§]/g,'Ø§').replace(/Ø©/g,'Ù‡').replace(/Ù‰/g,'ÙŠ')
    .replace(/[\u064B-\u065F\u0670]/g,'')
    .replace(/\s+/g,' ').trim().toLowerCase();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¯Ù‚ÙŠÙ‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function mRow(qw,row){
  const nr=row.map(c=>nm(c));

  /* â‘  Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ */
  for(let i=0;i<row.length;i++){
    const nc=nr[i]; if(!nc) continue;
    if(mCell(qw,nc)) return {matched:row[i],ci:i};
  }

  /* â‘¡ Ø®Ù„Ø§ÙŠØ§ Ù…ØªØªØ§Ù„ÙŠØ© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ */
  if(MODE==='exact'||MODE==='start'){
    const ne=nr.map((nc,i)=>({nc,i})).filter(x=>x.nc.length>0);
    for(let s=0;s<=ne.length-qw.length;s++){
      let ok=true;
      for(let w=0;w<qw.length;w++){
        if(!ne[s+w].nc.includes(qw[w])){ok=false;break;}
      }
      if(ok){
        return {matched:ne.slice(s,s+qw.length).map(x=>row[x.i]).join(' '),ci:ne[s].i};
      }
    }
  }

  /* â‘¢ Ø£ÙŠ ØªØ±ØªÙŠØ¨ Ø¹Ø¨Ø± Ø£ÙŠ Ø®Ù„Ø§ÙŠØ§ */
  if(MODE==='any'){
    const ne=nr.map((nc,i)=>({nc,i})).filter(x=>x.nc.length>0);
    const used=new Set(),idx=[];
    for(const w of qw){
      let f=false;
      for(const {nc,i} of ne){
        if(!used.has(i)&&nc.includes(w)){idx.push(i);used.add(i);f=true;break;}
      }
      if(!f) return null;
    }
    return {matched:idx.map(i=>row[i]).join(' '),ci:idx[0]};
  }
  return null;
}

function mCell(qw,nc){
  if(MODE==='exact'){
    let p=0;
    for(const w of qw){const i=nc.indexOf(w,p);if(i===-1)return false;p=i+w.length;}
    return true;
  }
  if(MODE==='any') return qw.every(w=>nc.includes(w));
  if(MODE==='start') return nc.startsWith(qw[0])&&qw.slice(1).every(w=>nc.includes(w));
  return false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function doS(){
  const raw=document.getElementById('sI').value.trim();
  if(!raw||!SH.length) return;
  const qw=raw.split(/\s+/).filter(w=>w.length>0).map(nm);
  if(!qw.length) return;

  const res=[];
  document.getElementById('eC').style.display='none';
  document.getElementById('rC').style.display='none';
  document.getElementById('pg').classList.add('on');
  sp(0,'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...');
  await slp(20);

  const tgt=ACT==='__all__'?SH:SH.filter(s=>s.name===ACT);
  for(let i=0;i<tgt.length;i++){
    for(const row of tgt[i].rows){
      const r=mRow(qw,row);
      if(r) res.push({name:r.matched,sheet:tgt[i].name,row});
    }
    sp(((i+1)/tgt.length)*100,'Ø¨Ø­Ø« ÙÙŠ: '+tgt[i].name);
    await slp(8);
  }

  sp(100,'Ø§ÙƒØªÙ…Ù„ âœ…');
  setTimeout(()=>document.getElementById('pg').classList.remove('on'),700);
  document.getElementById('sN').textContent=res.length.toLocaleString('ar');
  rend(res,raw.split(/\s+/).filter(w=>w.length>0));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function rend(res,qw){
  const list=document.getElementById('rL');
  list.innerHTML='';
  document.getElementById('cP').textContent=res.length;
  document.getElementById('rC').style.display='block';
  if(!res.length){
    list.innerHTML='<div class="em"><div class="ei">ğŸ”</div><div class="et">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬<br>Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙŠØ± ÙˆØ¶Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø±Ø§Ø¬Ø¹ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¡</div></div>';
    return;
  }
  const nq=qw.map(nm);
  res.forEach((r,i)=>{
    const cells=r.row.filter(c=>c&&c.trim()!=='');
    const cp=cells.join(' | ');
    const ch=cells.map(c=>{
      const h=nq.some(w=>nm(c).includes(w));
      return '<span class="ce'+(h?' ht':'')+'">'+es(c)+'</span>';
    }).join('');
    const d=document.createElement('div');
    d.className='ri'; d.style.animationDelay=(i*30)+'ms'; d.dataset.copy=cp;
    d.innerHTML='<button class="cb" onclick="cI(this,event)">ğŸ“‹</button>'+
      '<div class="rn">'+hl(r.name,qw)+'</div>'+
      '<div class="rtg"><span class="tg">ğŸ“„ '+es(r.sheet)+'</span><span class="tg">#'+(i+1)+'</span></div>'+
      '<div class="rc">'+ch+'</div>';
    list.appendChild(d);
  });
  setTimeout(()=>document.getElementById('rC').scrollIntoView({behavior:'smooth',block:'start'}),80);
}

function hl(txt,words){
  let r=es(txt);
  words.forEach(w=>{if(w)try{r=r.replace(new RegExp(er(es(w)),'gi'),m=>'<mark>'+m+'</mark>');}catch(_){}});
  return r;
}
function er(s){return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
function es(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}

function cI(btn,e){
  e.stopPropagation();
  wC(btn.closest('.ri').dataset.copy);
  btn.textContent='âœ…'; btn.classList.add('ok');
  setTimeout(()=>{btn.textContent='ğŸ“‹';btn.classList.remove('ok');},2000);
}
function cpAll(){
  const items=[...document.querySelectorAll('.ri')];
  wC(items.map((e,i)=>(i+1)+'. '+e.dataset.copy).join('\n\n'));
  toast('âœ… ØªÙ… Ù†Ø³Ø® '+items.length+' Ù†ØªÙŠØ¬Ø©');
}
function wC(t){
  if(navigator.clipboard){navigator.clipboard.writeText(t).then(()=>toast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!')).catch(()=>fb(t));}
  else fb(t);
}
function fb(t){
  const a=document.createElement('textarea');a.value=t;a.style.cssText='position:fixed;opacity:0;top:0;left:0';
  document.body.appendChild(a);a.focus();a.select();
  try{document.execCommand('copy');toast('âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!');}catch(_){toast('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®');}
  document.body.removeChild(a);
}

if('serviceWorker' in navigator){
  window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(()=>{}));
}
</script>
</body>
</html>
